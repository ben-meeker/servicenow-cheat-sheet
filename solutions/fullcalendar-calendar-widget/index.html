<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/default.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/atom-one-dark.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
<link rel="stylesheet" href="../../assets/css/solution.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/vbscript-html.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/css.min.js"></script>
<script>hljs.highlightAll();</script>
<h1 class="title">Fullcalendar Calendar Widget</h1>
<br>
<h2 class="label">Creator: <a class="important-link" href="https://github.com/ben-meeker">@ben-meeker</a></h2>
<br>
<p class="description">This is a basic widget for the ServiceNow Service Portal that implements <a class="important-link" href="https://fullcalendar.io">fullcalendar.io</a> - this allows for dynamic event creation, on-click event actions, and calendar styling.</p>
<br>
<h2 class="label left">Getting Started</h2>
<ul class="description">
    <li class="left">Create a new widget in your ServiceNow instance.</li>
    <li class="left">Add required dependencies.</li>
    <ul>
        <li class="left">Go to the widget platform view, scroll down to the Dependencies related list.</li>
        <li class="left">Click on New and name it Calendar. Press Submit.</li>
        <li class="left">Once your widget dependency has been created, open it and click on the JS Includes related list.</li>
        <li class="left">Click on New and set the Source to URL</li>
        <li class="left">Enter this URL into the JS file URL field: 'https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.5.1/fullcalendar.min.js'. Press Submit.</li>
        <li class="left">Navigate back to your widget dependency record and click on the CSS Includes related list.</li>
        <li class="left">Click on New and set the Source to URL.</li>
        <li class="left">Enter this URL into the CSS file URL field: 'https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.5.1/fullcalendar.min.css'. Press Submit.</li>
    </ul>
    <li class="left">Fill out widget script fields with included code.</li>
</ul>
<br>
<h2 class="label left">HTML Template</h2>
<pre><code class="language-html theme-atom-one-dark">
&lt;div&gt;
    &lt;!-- This div is a placeholer for the calendar (see Client Script) --&gt;
    &lt;div id="calendar"&gt;&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<br>
<h2 class="label left">CSS-SCSS</h2>
<pre><code class="language-css theme-atom-one-dark">
/* Override existing calendar CSS. Find these classes in Google Inspect */
.fc td,.fc th {
    border-color: #309C42;
    background-color: #ffffff;
}

.fc-left {
    color: #212121;
    font-family: 'GT Super Text';
}

.fc button {
    border-color: #309C42;
    background-color: #ffffff;
}
</code></pre>
<br>
<h2 class="label left">Client Script</h2>
<pre><code class="language-javascript theme-atom-one-dark">
api.controller=function() {
    /* widget controller */
    var c = this;

    // Load fullcalendar.io calendar with options
    $("#calendar").fullCalendar({
    events: c.data.eventList,
    // Set default event color
    eventColor: '#344C38',
    // Do something when clicked
    eventClick: function (event) {
        alert("Give some sort of alert/message");
        // Redirect to page
        top.window.location = 'https://github.com/ben-meeker/servicenow-calendar-widget';
    }
    });
};
</code></pre>
<br>
<h2 class="label left">Server Script</h2>
<pre><code class="language-javascript theme-atom-one-dark">
(function() {
    data.eventList=[];
    
    // Get events from table
    var events = new GlideRecord('incident')
    // Add queries to narrow down data
    events.addQuery('date>=javascript:gs.beginningOfLastMonth()')
    events.query()
    while (events.next()) {
        var eventJSON = {};
        
        // Set event JSON fields with useful data
       
        // Set title of event
        eventJSON.title = events.getValue('short_description');
        // Set date field to tell calendar when to display event
        eventJSON.date = events.getValue('due_date');
        // Set allDay to true to remove time display on event in calendar
        eventJSON.allDay = true;

        // Set custom fields for specific use cases
        eventJSON.sys_id = events.getValue('sys_id');
        eventJSON.assigned_to = events.getValue('assigned_to');
        
        // Set additional fields based on criteria
        if (events.getValue('assigned_to') == false) {
            eventJSON.color = 'white';
            eventJSON.textColor = '#344C38';
            eventJSON.borderColor = '#344C38';
        }
            
        data.eventList.push(eventJSON);
    }
})();
</code></pre>
